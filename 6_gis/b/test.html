<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenLayers Click Line Example</title>
    <link rel="stylesheet" href="./ol.css" />
    <style>
        #map {
            width: 100%;
            height: 90vh; /* 맵 높이를 90%로 설정 */
        }
        #coordinates {
            height: 10vh; /* 좌표 표시 영역 높이를 10%로 설정 */
            background-color: #f8f9fa; /* 배경색 설정 */
            padding: 10px;
            font-family: Arial, sans-serif;
            font-size: 14px;
            resize: none; /* textarea 크기 조절 불가 */
            width: 100%; /* 너비 100%로 설정 */
        }
    </style>
</head>
<body>
    <div id="map" class="map"></div>
    <textarea id="coordinates" readonly>클릭한 좌표: </textarea> <!-- 좌표 출력 영역을 textarea로 변경 -->
    <script src="./ol.js"></script>
    <script>
        // 기본 맵 설정
        const map = new ol.Map({
            target: 'map',
            layers: [
                new ol.layer.Tile({
                    source: new ol.source.OSM()
                })
            ],
            view: new ol.View({
                center: ol.proj.fromLonLat([126.978, 37.566]), // 서울의 좌표
                zoom: 10
            })
        });

        // 선을 그릴 피처 레이어 생성
        const lineLayer = new ol.layer.Vector({
            source: new ol.source.Vector(),
            style: new ol.style.Style({
                stroke: new ol.style.Stroke({
                    color: 'gray',
                    width: 9
                })
            })
        });

        // 맵에 레이어 추가
        map.addLayer(lineLayer);

        // 클릭한 좌표를 저장하기 위한 배열
        const clickedCoordinates = [];

        // 클릭 이벤트 리스너 추가
        map.on('singleclick', function (event) {
            const coordinate = event.coordinate;

            // 새로운 선 추가
            clickedCoordinates.push(coordinate); // 클릭한 좌표 추가

            // 새 선을 생성하고 추가
            const lineFeature = new ol.Feature({
                geometry: new ol.geom.LineString(clickedCoordinates)
            });
            lineLayer.getSource().clear(); // 이전 선 삭제
            lineLayer.getSource().addFeature(lineFeature); // 새 선 추가

            // 좌표를 ol.proj.fromLonLat 형식으로 변환하여 표시
            const lonLat = ol.proj.toLonLat(coordinate);
            document.getElementById('coordinates').value += ` [${lonLat[0].toFixed(4)}, ${lonLat[1].toFixed(4)}],`; // 출력 형식 수정
        });

        // 우클릭 이벤트 리스너 추가
        map.on('contextmenu', function (event) {
            event.preventDefault(); // 기본 우클릭 메뉴 방지

            // 클릭한 좌표가 있을 경우 처리
            if (clickedCoordinates.length > 0) {
                // 마지막 클릭 좌표 제거
                clickedCoordinates.pop(); // 마지막 좌표 제거

                // 새 선을 생성하고 추가
                const lineFeature = new ol.Feature({
                    geometry: new ol.geom.LineString(clickedCoordinates)
                });
                lineLayer.getSource().clear(); // 이전 선 삭제
                lineLayer.getSource().addFeature(lineFeature); // 새 선 추가

                // 좌표 출력 업데이트
                document.getElementById('coordinates').value = '클릭한 좌표: '; // 좌표 출력 초기화
                clickedCoordinates.forEach(coord => {
                    const lonLat = ol.proj.toLonLat(coord);
                    document.getElementById('coordinates').value += ` [${lonLat[0].toFixed(4)}, ${lonLat[1].toFixed(4)}]`; // 출력 형식 수정
                });
            }
        });

        // ** 아래 부분은 미리 정의된 선을 추가하는 함수입니다. **
       /* (function() {
            const predefinedLineCoordinates = [
                                [14130219.23110959,4517494.122201387], [14130259.330275387,4517462.499287377], [14130280.846890625,4517447.502847645], [14130304.31955727,4517439.35261272], [14130331.378347179,4517436.092518748], [14130359.741154782,4517436.092518748], [14130388.42999168,4517438.048582593], [14130425.595067926,4517440.656630409], [14130466.346242568,4517444.242753674], [14130489.166900367,4517446.8508388], [14130504.815361379,4517446.8508388], [14130553.064762104,4517448.806865336], [14130595.119954437,4517449.132894632], [14130629.620392986,4517450.394366639], [14130655.37514033,4517450.394366639], [14130698.734375227,4517451.046412793], [14130748.287843386,4517452.024413626], [14130836.302416358,4517454.139815131], [14130853.90692878,4517456.095878979], [14130868.903356073,4517458.377934808], [14130886.507868495,4517467.832212298], [14130918.782803785,4517486.088733565], [14130927.911051981,4517491.956912661], [14130954.96984189,4517512.821506617], [14130976.160452707,4517529.121976473], [14130988.928351523,4517543.717059192], [14131017.943192841,4517578.92609647], [14131033.917633403,4517601.746754269]
            ];

            // 미리 정의된 선 추가 함수
            function addPredefinedLine() {
                const predefinedLineFeature = new ol.Feature({
                    geometry: new ol.geom.LineString(predefinedLineCoordinates)
                });
                lineLayer.getSource().addFeature(predefinedLineFeature);
            }

            // 초기 미리 정의된 선 추가
            addPredefinedLine(); // 즉시 실행 함수 안에 추가
        })(); // 즉시 실행 함수
*/

    </script>
</body>
</html>
